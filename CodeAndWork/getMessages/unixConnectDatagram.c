/*
 * getNamedMessages.c
 */

#include <sys/socket.h>
#include <stdio.h>
#include <stdlib.h>
#include <sys/un.h>
#include <string.h>
#include <unistd.h>

#define MAX_BYTES_READ 4096

void Usage();
void PrintHex(char *str, int len);

int main(int argc, char *argv[])
{
    if (argc != 2)
    {
        Usage();
        exit(1);
    }

    char *dest = argv[1];

    int sock;
    struct sockaddr_un name;

    char *data = "\x00\x00\x00\x00\x00\x11\x00\x01\x00\x00\x00\x00\x08\x5f\x61\x69\x72\x70\x6f\x72\x74\x04\x5f\x74\x63\x70\x05\x6c\x6f\x63\x61\x6c\x00\x00\x0c\x00\x01\x08\x5f\x61\x69\x72\x70\x6c\x61\x79\xc0\x15\x00\x0c\x00\x01\x05\x5f\x72\x61\x6f\x70\xc0\x15\x00\x0c\x00\x01\x07\x5f\x69\x70\x70\x75\x73\x62\xc0\x15\x00\x0c\x00\x01\x06\x5f\x75\x73\x63\x61\x6e\xc0\x15\x00\x0c\x00\x01\x08\x5f\x70\x72\x69\x6e\x74\x65\x72\xc0\x15\x00\x0c\x00\x01\x04\x5f\x69\x70\x70\xc0\x15\x00\x0c\x00\x01\x07\x5f\x75\x73\x63\x61\x6e\x73\xc0\x15\x00\x0c\x00\x01\x04\x5f\x70\x74\x70\xc0\x15\x00\x0c\x00\x01\x0f\x5f\x70\x64\x6c\x2d\x64\x61\x74\x61\x73\x74\x72\x65\x61\x6d\xc0\x15\x00\x0c\x00\x01\x08\x5f\x73\x63\x61\x6e\x6e\x65\x72\xc0\x15\x00\x0c\x00\x01\x05\x5f\x69\x70\x70\x73\xc0\x15\x00\x0c\x00\x01\x07\x5f\x72\x64\x6c\x69\x6e\x6b\xc0\x15\x00\x0c\x00\x01\x0f\x5f\x63\x6f\x6d\x70\x61\x6e\x69\x6f\x6e\x2d\x6c\x69\x6e\x6b\xc0\x15\x00\x0c\x00\x01\x0d\x5f\x61\x70\x70\x6c\x65\x2d\x6d\x6f\x62\x64\x65\x76\xc0\x15\x00\x0c\x00\x01\x08\x38\x62\x61\x65\x30\x37\x63\x30\x04\x5f\x73\x75\x62\x0e\x5f\x61\x70\x70\x6c\x65\x2d\x6d\x6f\x62\x64\x65\x76\x32\xc0\x15\x00\x0c\x00\x01\x0f\x5f\x61\x70\x70\x6c\x65\x2d\x70\x61\x69\x72\x61\x62\x6c\x65\xc0\x15\x00\x0c\x00\x01\xc0\xcd\x00\x0c\x00\x01\x00\x00\x0d\x9e\x00\x1a\x17\x42\x72\x65\x6e\x64\x61\x6e\xe2\x80\x99\x73\x20\x4d\x61\x63\x42\x6f\x6f\x6b\x20\x50\x72\x6f\xc0\xcd";

    /* Create socket on which to send. */
    sock = socket(AF_UNIX, SOCK_DGRAM, 0);
    if (sock < 0) {
        perror("opening datagram socket");
        exit(1);
    }
    /* Construct name of socket to send to. */
    name.sun_family = AF_UNIX;
    strcpy(name.sun_path, dest);
    struct sockaddr *destSock = (struct sockaddr *) &name;
    /* Send message. */
    if (sendto(sock, data, 342, 0, destSock, sizeof(struct sockaddr_un)) < 0) {
        perror("sending datagram message");
    }
    close(sock);
}

void Usage()
{
    printf("getNamedMessages sockName");
}

void PrintHex(char *str, int len)
{
    char *temp = str;
    for (int i = 0; i < len; i ++)
    {
        printf("%02x ", (*(temp + i) & 0xff));
    }
    printf("\n");
}
